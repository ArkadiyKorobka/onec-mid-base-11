#Область ПрограммныйИнтерфейс

Процедура Дополнитьформу(форма) Экспорт
	ИмяФормы = Форма.ИмяФормы;
	
	//Начало доработки
	//Коробка А.А. 10.08.2025
	// Добавлена обработка формы заказа покупателя с новыми полями
	//Исходный код:
	//  (отсутствовала обработка формы заказа покупателя)
	//Новый код:
	Если ИмяФормы = "Документ.ЗаказПокупателя.Форма.ФормаДокумента" Тогда 
		ДобавитьПолеКонтактноеЛицоВГруппаШапкаПраво(Форма); 
		ДобавитьПолеСогласованнаяСкидкаВГруппаШапкаПраво(Форма);
		ДобавитьКнопкуВГруппаШапкаПраво(Форма);
		//Конец доработки
		
	ИначеЕсли ИмяФормы = "Документ.ПоступлениеТоваровУслуг.Форма.ФормаДокумента" Тогда 
		ДобавитьПолеКонтактноеЛицоВГруппаШапкаПраво(Форма);
	ИначеЕсли ИмяФормы = "Документ.РеализацияТоваровУслуг.Форма.ФормаДокумента" Тогда 
		ДобавитьПолеКонтактноеЛицоВГруппаШапкаПраво(Форма);
	ИначеЕсли ИмяФормы = "Документ.ОплатаОтПокупателя.Форма.ФормаДокумента" Тогда 
		ВставитьПолеКонтактноеЛицоНаФормуПередСуммаДокумента(Форма);
	ИначеЕсли ИмяФормы = "Документ.ОплатаПоставщику.Форма.ФормаДокумента" Тогда 
		ВставитьПолеКонтактноеЛицоНаФормуПередСуммаДокумента(Форма);
	КонецЕсли;
КонецПроцедуры

#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

Процедура ДобавитьПолеКонтактноеЛицоВГруппаШапкаПраво(форма)
	ПолеВвода = Форма.Элементы.Добавить ("КонтактноеЛицо", Тип("Полеформы"), Форма.Элементы.ГруппаШапкаПраво); 
	ПолеВвода.Вид = ВидПоляформы.ПолеВвода; 
	ПолеВвода.ПутьКДанным = "Объект.КА_КонтактноеЛицо";
КонецПроцедуры 

Процедура ВставитьПолеКонтактноеЛицоНаформуПередСуммаДокумента(Форма)
	// Проверяем существование элемента СуммаДокумента
	Если Не Форма.Элементы.СуммаДокумента <> Неопределено Тогда
		ПолеВвода = Форма.Элементы.Вставить("КонтактныеЛица", Тип("Полеформы"), Форма.Элементы.СуммаДокумента); 
		ПолеВвода.Вид = ВидПоляформы.ПолеВвода;
		ПолеВвода.ПутьКДанным = "Объект.КА_КонтактноеЛицо";
	Иначе
		// Если элемента нет, просто добавляем в конец
		ПолеВвода = Форма.Элементы.Добавить("КонтактныеЛица", Тип("Полеформы")); 
		ПолеВвода.Вид = ВидПоляформы.ПолеВвода;
		ПолеВвода.ПутьКДанным = "Объект.КА_КонтактноеЛицо";
	КонецЕсли;
КонецПроцедуры

//Начало доработки
//Коробка А.А. 10.08.2025
// Добавлена новая процедура для поля скидки
//Исходный код:
//  (отсутствовала процедура работы со скидкой)
//Новый код:
Процедура ДобавитьПолеСогласованнаяСкидкаВГруппаШапкаПраво(форма)
	ПолеВвода = Форма.Элементы.Добавить("СогласованнаяСкидка", Тип("Полеформы"), Форма.Элементы.ГруппаШапкаПраво); 
	ПолеВвода.Вид = ВидПоляформы.ПолеВвода; 
	ПолеВвода.ПутьКДанным = "Объект.КА_СогласованнаяСкидка";
	
	// Добавляем обработчик изменения скидки
	ПолеВвода.УстановитьДействие("ПриИзменении", "СогласованнаяСкидкаПриИзменении"); 
КонецПроцедуры

//Начало доработки
//Коробка А.А. 10.08.2025
// Добавлена процедура создания кнопки пересчета
//Исходный код:
//  (отсутствовала процедура создания кнопки)
//Новый код:
Процедура ДобавитьКнопкуВГруппаШапкаПраво(форма)
	Команда = Форма.Команды.Добавить("КЛ_ПересчитатьСуммы");
	Команда.Действие = "КЛ_ПересчитатьСуммыПосле";
	Команда.Заголовок = "Пересчитать суммы";
	Кнопка = Форма.Элементы.Добавить("КЛ_ПересчитатьСуммы", Тип("КнопкаФормы"), Форма.Элементы.ГруппаШапкаПраво);
	Кнопка.ИмяКоманды = "КЛ_ПересчитатьСуммы";
	Кнопка.Вид = ВидКнопкиФормы.КнопкаКоманднойПанели;
КонецПроцедуры
//КонецДоработки
#КонецОбласти